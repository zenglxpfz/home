<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>About</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta name="keywords" content=""/>

    <script type="application/x-javascript">
        addEventListener("load", function () {
            setTimeout(hideURLbar, 0);
        }, false);

        function hideURLbar() {
            window.scrollTo(0, 1);
        }
    </script>
    <link rel="stylesheet" href="/css/bootstrap.css"> <!-- Bootstrap-Core-CSS -->
    <link href="/css/style.css" rel='stylesheet' type='text/css'/>
    <link href="/css/fontawesome-all.css" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Exo+2" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
          rel="stylesheet">
    <!--	描述：elm -->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
    <script src="base/plugins/jquery/jquery.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="base/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="base/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
    <link rel="stylesheet" href="/css/common.css">
    <!--elm  -->
</head>

<body>
<header>
    <div class="header">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="index.html">同城搬家供需信息交流平台</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item ">
                        <a class="nav-link" href="/userservice/main">首页<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/u/order">我的团队订单</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/myteammessage">我的团队信息</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/u/contact">我的团队消息</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="/u/myliuyan">我的消息</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link " href="/forteam/notice">告示</a>
                    </li>

                    <li class="nav-item dropdown">
                        <input type="hidden" id="userid" th:if=" ${session.userservice} ne null"
                               th:value="${session.userservice.uid}"/>
                        <input type="hidden" id="uname" th:if=" ${session.userservice} ne null"
                               th:value="${session.userservice.uname}"/>
                        <input type="hidden" id="code" th:if=" ${session.userservice} ne null"
                               th:value="${session.userservice.code}"/>
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span th:if=" ${session.userservice} ne null" th:text="${session.userservice.uname}"></span>
                            <span th:if="${session.userservice} eq null " th:text="请登录"></span>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" th:if="${session.userservice} ne null" href="/loginup">
                                <span th:if="${session.userservice} ne null " th:text="注销"></span>
                            </a>
                            <a class="dropdown-item" th:if="${session.userservice} eq null " href="/">
                                <span th:if="${session.userservice} eq null " th:text="登录"></span>
                            </a>
                            <a href="#" class="dropdown-item" data-toggle="modal" data-target="#persionmessage"
                               role="button">查看个人信息</a>
                            <a href="#" class="dropdown-item" data-toggle="modal" data-target="#editmessage"
                               role="button">编辑个人信息</a>
                        </div>
                    </li>
                </ul>

            </div>
        </nav>
    </div>
</header>


<input type="hidden" th:if="${session.team} ne null" id="tid" th:value="${session.team.tid}">
<input type="hidden" th:if="${session.bid} ne null" id="bid" th:value="${session.bid}">
<input type="hidden" th:if="${session.user} ne null" id="uid" th:value="${session.user.uid}">
<input type="hidden" th:if="${session.team} ne null" id="tname" th:value="${session.team.tname}">


<div class="row" style="height:auto; width: 100%;padding: 0px 20px 0px">
    <div id="order" style="width: 100%;padding: 0px 20px 0px">
        <div class="w3-head-all text-center mb-5" style="padding: 30px 0 0 0">
            <h4>{{notice.tital}}</h4>
        </div>
        <div class="card " >
            <div class="card-header">
                <h4>{{notice.username}}:</h4>
            </div>
            <div class="card-body" >
                <h5 class="card-title">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{notice.content}}</h5>
                <span>联系电话：<span style="color: blue">{{notice.userDTO.phone}}</span></span>
                <p class="card-text"></p>
            </div>

            <div class="card-footer text-muted">
                <h6>发布于：{{notice.crieatetime}}</h6> {{notice.time}}
                <span>评论({{notice.countpl}})</span>
            </div>
        </div>



        <hr/>
        <span>评论区：</span>
        <hr/>
        <div>
            <div style="height: auto;width: 100%;" v-for="(o, index) in pinglun" :key="o" :offset="index > 0 ? 1 : 0">

                <div class="row" style="padding: 30px">
                    <div class="col-md-3">
                        <h5>{{o.uname}}</h5>
                        <span style="font-size: 10px;">{{o.createtime}}</span><br/>

                        <span>{{o.content}}</span>
                    </div>
                    <div class="col-md-3 ">
                        <span>{{o.scoring}}</span>
                        <span>{{o.time}}</span>
                    </div>
                    <div class="col-md-3 col-md-offset-6" style="padding: 30px 20px" >
                        <el-button v-if="o.uname==loginname"   round type="danger" size="small"   @click="del(o)">删除</el-button>
                    </div>
                </div>
                <div class="row">

                    <div class="col-md-8">
                        <el-collapse v-model="activeNames" @change="handleChange">
                            <el-collapse-item title="查看回复" name="4">
                                <div style="height: auto;">

                                    <div v-for="(h, index1) in o.huifuplDTOS" :key="a" :offset="index > 0 ? 1 : 0">
                                        <div class="row">
                                            <div class="col-md-10">
                                        <a href="javascript:void(0);" @click="x(h,index)">{{h.username}}</a>回复
                                        <a href="javascript:void(0);" @click="y(h,index)">{{h.useredname}}</a>：{{h.content}}

                                            <span>{{h.createtime}}</span>

                                            </div>
                                            <div class="col-md-2 " style="padding: 20px">
                                        <el-button v-if="h.username==loginname" round type="danger" size="small"  @click="delhuifu(h,index)">删除</el-button>
                                            </div>
                                        </div>
                                        <br />
                                        <!--<el-button @click="dialogVisible = true">回复</el-button>-->
                                    </div>
                                    <div class="row" >
                                        <div class="col-md-8">
                                    <el-input maxlength="100" style="width: 100%"  show-word-limit type="textarea" v-model="a[index].content" :placeholder="'回复'+a[index].name"/>
                                        </div>
                                        <el-button size="small" type="primary" round @click="re(index)">回复</el-button>

                                    </div>
                                </div>
                            </el-collapse-item>
                        </el-collapse>
                    </div>
                </div>
            </div>
            <el-divider><i class="el-icon-mobile-phone"></i></el-divider>
            <div>
                <el-form :model="addpls" ref="addpls" :rules="rules">
                    <input type="hidden" id="cid" />
                    <el-form-item  prop="content">
                        <textarea v-model="addpls.content"  class="comment-content open" style="width: 100%;height: 65px" name="comment" id="comment" maxlength="1000" placeholder="回答点什么呢"></textarea>
                    </el-form-item>
                    <div class="opt-box">
                        <div  class="text-right" style="padding: 30px 0 20px 0; font-size: 25px">
                            <a href="javascript:void(0);" @click="fabiao('addpls')">发表</a>
                        </div>
                    </div>
                </el-form>
            </div>
        </div>

    </div>

</div>


<div class="footer-main">
    <div class="footer-social">
        <h4>关于平台</h4>
        <ul>
            <li>

                <span class="fab fa-facebook-f icon_facebook"></span>
                <p style="color: white;">服务范围为广东省广州市地区</p>

            </li>

        </ul>
    </div>
    <div class="cpy-right">
        <p>2020-3-5 《同城搬家供需信息交流平台》平台联系人：曾运棋 联系电话：12345678910</p>
    </div>
</div>
<!-- //footer -->
<!-- odometer-script -->
<script src="/js/odometer.js"></script>
<script>
    window.odometerOptions = {
        format: '(ddd).dd'
    };
</script>
<script>
    setTimeout(function () {
        jQuery('#w3l_stats1').html(25);
    }, 1500);
</script>
<script>
    setTimeout(function () {
        jQuery('#w3l_stats2').html(330);
    }, 1500);
</script>
<script>
    setTimeout(function () {
        jQuery('#w3l_stats3').html(542);
    }, 1500);
</script>
<!-- //odometer-script -->

<!-- js -->
<script type="text/javascript" src="/js/jquery-2.2.3.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.js"></script> <!-- Necessary-JavaScript-File-For-Bootstrap -->
<!-- //js -->
<!-- start-smooth-scrolling -->
<script src="/js/move-top.js"></script>
<script src="/js/easing.js"></script>
<script>
    jQuery(document).ready(function ($) {
        $(".scroll").click(function (event) {
            event.preventDefault();

            $('html,body').animate({
                scrollTop: $(this.hash).offset().top
            }, 1000);
        });
    });
</script>
<!-- //end-smooth-scrolling -->

<!-- smooth-scrolling-of-move-up -->
<script>
    $(document).ready(function () {
        $().UItoTop({
            easingType: 'easeOutQuart'
        });
    });
</script>
<!-- //smooth-scrolling-of-move-up -->


<!-- smooth scrolling js -->
<script src="/js/SmoothScroll.min.js"></script>
<!-- //smooth scrolling js -->
<!--
	作者：offline
	时间：2020-03-09
	描述：查看订单列表
-->
<script>
    var myname = $("#myuname").val();
  //  var mytname = $("#mytname").val();
    var bid = $("#bid").val();
    //团队的名字
    var tname = $("#tname").val();
    var tid = $("#tid").val();
    var code = $("#code").val();
   // var uid = $("uid").val();
    new Vue({
        el: '#order',
        data: function () {
            return {
                loginname:tname,
                pinglun: [],
                order: [],
               // table: false,
                a: [{
                    content: '',
                    name: '',
                    fid:'',
                    useredname: '',  //被回复的人的名字
                    username: '',   //回复人的名字
                    type: '2'   //类型回复
                }],
                dialog: false,
                loading: false,
                addpinglun: {
                    oid: '',
                    tname: '',
                    content: '',
                    scoring: '',
                    type: '1',
                },
                addhiufu: {
                    aid: '',
                    username: '',
                    useredname: '',
                    content: '',
                    type: '2'
                },
                addpls: {
                    zid: '',
                    tname: '',//被回复的人
                    content: '',
                    type: '2',
                    uname:'',//回复人
                    uid:'',
                    role:'2',
                    tid:''

                },
                notice:{},
                formLabelWidth: '80px',
                timer: null,
                rules: {
                    // tital: [
                    //     { required: true, message: '请输入公告标题', trigger: 'change' },
                    //
                    // ],
                    content: [
                        { required: true, message: '请输入评论内容', trigger: 'blur' }
                    ],

                }
            };
        },
        created() {
            const that = this;
            that.getpinglun();
            that.getnotice();
        },
        methods: {

            getnotice() {
                axios.get('/notice/selectbyid', {
                        params: {
                            bid:bid
                        }
                    }
                ).then(req => {
                    this.notice = req.data.data;
                })
            },
            getpinglun() {
                axios.get('/notice/getpinlun', {
                        params: {
                            zid:bid
                        }
                    }
                ).then(req => {
                    this.pinglun = req.data.data;
                    console.log("==================================================================")
                    console.log(tname);
                    console.log("===================================================================")
                    console.log(this.loginname);

                    req.data.data.forEach((v, index) => {
                        let a = {
                            content: '',
                            name:'',
                            useredname: '',  //被回复的人的名字
                            username: '',   //回复人的名字
                            type: '2'   //类型回复
                        };
                        this.a.push(a);
                        // this.a[index].hu='';
                        // this.a[index].name='';
                        // console.log("+++++++++++++++++++++++++++++++++++++++++++");
                        console.log(this.a);
                    });

                    // this.huifu = req.data.data[0].huifuplDTOS;
                })
            },

            // addpinglun(add) {
            //     this.dialog = true;
            //     this.pinglun.oid = add.oid;
            //     this.pinglun.tname = add.tname;
            // },
            // handleClose(done) {
            //     if (this.loading) {
            //         return;
            //     }
            //     this.$confirm('确定要发布评论吗？')
            //         .then(_ => {
            //             // this.loading = true;
            //             this.timer = setTimeout(() => {
            //                 axios.post('/pinglun/add', JSON.stringify(this.pinglun), {
            //                         headers: {
            //                             'Content-Type': 'application/json;charset=UTF-8'
            //                         }
            //                     }
            //                 ).then(req => {
            //                     // 动画关闭需要一定的时间
            //                     setTimeout(() => {
            //                         this.loading = false;
            //                     }, 400);
            //                     window.location.href = "/order"
            //                 })
            //
            //             }, 2000);
            //         })
            //     ;
            // },
            cancelForm() {
                this.loading = false;
                this.dialog = false;
                clearTimeout(this.timer);
            },

            x(b, index) {
                console.log(
                    '===================================================================='
                );// this.ah = a;
                console.log(b);
                this.a[index].name = b.username;
                this.a[index].username = tname;
                this.a[index].useredname = b.username;
                // this.a[index].fid = this.pinglun[index].aid;
                // this.a[index].comment =
                //  this.dialogVisible = true;
            },
            y(b, index) {
                console.log(
                    '===================================================================='
                );// this.ah = a;
                console.log(b);
                this.a[index].name = b.useredname;
                this.a[index].username = tname;
                this.a[index].useredname = b.useredname;
                //this.a[index].fid = this.pinglun[index].aid;
                // this.a[index].username =
                //     aid:'',
                //     username:'',
                //     useredname:'',
                // this.dialogVisible = true;
            },
            re(index) {
                if(this.a[index].content==''){
                    this.$message({message: '回复内容不能为空！', type: 'error'});
                    return false;
                }
                this.a[index].fid = this.pinglun[index].aid;
                if(this.a[index].name==''){
                    this.a[index].username=tname;
                    this.a[index].useredname=this.pinglun[index].uname;
                }
                axios.post('/pinglun/add', JSON.stringify(this.a[index]), {
                        headers: {
                            'Content-Type': 'application/json;charset=UTF-8'
                        }
                    }
                ).then(req => {
                    this.getpinglun();
                    this.a[index].content='';
                })
                console.log(this.a[index])

            },
            // x(b, index) {
            //     console.log(
            //         '===================================================================='
            //     );// this.ah = a;
            //     console.log(b);
            //     this.a[index].name = b.username;
            //     this.a[index].username = myname;
            //     this.a[index].useredname = b.username;
            //    // this.a[index].fid = this.pinglun[index].aid;
            //    // this.a[index].comment =
            //   //  this.dialogVisible = true;
            // },
            // y(b, index) {
            //     console.log(
            //         '===================================================================='
            //     );// this.ah = a;
            //     console.log(b);
            //     this.a[index].name = b.useredname;
            //     this.a[index].username = myname;
            //     this.a[index].useredname = b.useredname;
            //     //this.a[index].fid = this.pinglun[index].aid;
            //     // this.a[index].username =
            //     //     aid:'',
            //     //     username:'',
            //     //     useredname:'',
            //        // this.dialogVisible = true;
            // },
            // re(index) {
            //     this.a[index].fid = this.pinglun[index].aid;
            //     if(this.a[index].name==''){
            //         this.a[index].username=myname;
            //         this.a[index].useredname=this.pinglun[index].uname;
            //     }
            //     axios.post('/pinglun/add', JSON.stringify(this.a[index]), {
            //             headers: {
            //                 'Content-Type': 'application/json;charset=UTF-8'
            //             }
            //         }
            //     ).then(req => {
            //         this.getpinglun();
            //         this.a[index].content='';
            //     })
            //     console.log(this.a[index])
            //
            // },
            del(a){
                var aid = a.aid;
                axios.get('/pinglun/del', {
                        params:{
                            aid:aid
                        }
                    }
                ).then(req => {
                    this.getpinglun();
                    this.a[index].content='';
                })
            },
            delhuifu(a,index){
                var aid = a.aid;
                axios.get('/huifupl/del', {
                        params:{
                            aid:aid
                        }
                    }
                ).then(req => {
                    this.getpinglun();
                    this.a[index].content='';
                })
            },
            //发布文本
            fabiao(fb){
                this.$refs[fb].validate((valid) => {
                    if (valid) {
                        if(code=="0"){
                            this.$message({message: '还没有团队，不能发表评论哦！', type: 'error'});
                            return false;
                        }
                    this.addpls.uname =tname;
                    this.addpls.tname=this.notice.username;
                    this.addpls.zid = this.notice.bid;
                    //if()
                    this.addpls.uid = tid;
                this.addpls.tid = this.notice.uid;
                axios.post('/notice/addpl', JSON.stringify(this.addpls), {
                        headers: {
                            'Content-Type': 'application/json;charset=UTF-8'
                        }
                    }
                ).then(req => {

                    this.$message({message: '评论成功！', type: 'success'});
                    this.getnotice();
                    this.getpinglun();

                    this.addpls={
                        zid: '',
                            tname: '',//被回复的人
                            content: '',
                            type: '2',
                            uname:'',//回复人
                            uid:'',

                    };
                })
                    }else {
                        this.$message({message: '评论内容不能为空！', type: 'error'});
                        return false;
                    }
                });
            },

        }
    })
</script>
<style>
    .comment-box .comment-edit-box {
        padding: 16px 24px 8px;
        padding-top: 16px;
        padding-right: 24px;
        padding-bottom: 8px;
        padding-left: 24px;
    }
    .comment-box .comment-edit-box form .comment-content.open + .opt-box {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
    }
    .comment-box .comment-edit-box form .opt-box {
        display: none;
        margin-top: 8px;
    }
    #csdn-userTooltip a:link, a:focus, a:hover, a:visited {
        text-decoration: none!important;
        text-decoration-line: none !important;
        text-decoration-style: initial !important;
        text-decoration-color: initial !important;
    }
</style>
</body>
</html>
